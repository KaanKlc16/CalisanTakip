@{
    ViewData["Title"] = "Takvim";
    Layout = "~/Views/Shared/_LayoutYonetici.cshtml";
}

<h1 class="text-center my-4 text-white">Takvim</h1>

<div id="calendar"></div>

<!-- FullCalendar CSS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" rel="stylesheet">

<!-- Bootstrap CSS (for modal and other styles) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Modal for event details -->
<div id="eventModal" class="modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Etkinlik Detayları</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="modalDescription"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
            </div>
        </div>
    </div>
</div>

<!-- FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>

<!-- Calendar Initialization -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            events: '/Yonetici/GetCalendarEvents', 
            editable: true,
            eventResizableFromStart: true, 
            eventDrop: function (info) {
                
                updateEvent(info.event);
            },
            eventResize: function (info) {
                // Event is resized
                updateEvent(info.event);
            },
            eventClick: function (info) {
                // Display event details in the modal
                document.getElementById('modalTitle').innerText = info.event.title;
                document.getElementById('modalDescription').innerText = info.event.extendedProps.description;

                // Personel adını modal'a ekliyoruz
                if (info.event.extendedProps.personelAdSoyad) {
                    document.getElementById('modalDescription').innerText += '\nAtanan Personel: ' + info.event.extendedProps.personelAdSoyad;
                }

                var modal = new bootstrap.Modal(document.getElementById('eventModal'));
                modal.show();
            },

            eventColor: '#03a9f4', 
            displayEventTime: true 
        });

        calendar.render();

        
        function updateEvent(event) {
            // Prepare data to be sent
            var eventData = {
                id: event.id,
                start: event.start.toISOString(),
                end: event.end ? event.end.toISOString() : event.start.toISOString() // If no end date, use start date
            };

            // Send an AJAX request to update the event in the database
            fetch('/Yonetici/UpdateEvent', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(eventData)
            }).then(response => {
                if (response.ok) {
                    console.log("Event updated successfully!");
                } else {
                    alert("There was an error updating the event.");
                    calendar.refetchEvents(); // Revert the event changes if the update fails
                }
            }).catch(error => {
                alert("There was an error: " + error);
                calendar.refetchEvents(); // Revert the event changes if there's a network error
            });
        }
    });
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Additional Styles -->
<style>
    body {
        background-color: #2c3e50;
    }

    #calendar {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    h1 {
        color: #ffffff;
    }
</style>
